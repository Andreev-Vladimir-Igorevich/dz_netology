# Домашнее задание к занятию 11.4 "Очереди RabbitMQ" -Андреев В.И.


# Задание 1. Установка RabbitMQ

Используя Vagrant или VirtualBox, создайте виртуальную машину и установите RabbitMQ. Добавьте management plug-in и зайдите в веб интерфейс.

Итогом выполнения домашнего задания будет приложенный скриншот веб интерфейса RabbitMQ.
___
**Ответ**

![1](https://user-images.githubusercontent.com/94833070/195398754-5540893d-2f11-485b-af49-d67e4d89b7e4.png)

# Задание 2. Отправка и получение сообщений.
Используя приложенные скрипты, проведите тестовую отправку и получение сообщения. Для отправки сообщений необходимо запустить скрипт producer.py

Для работы скриптов вам необходимо установить Python версии 3 и библиотеку pika. Также в скриптах нужно указать ip адрес машины, на которой запущен RabbitMQ, заменив localhost на нужный ip.

$ pip install pika
Зайдите в веб интерфейс, найдите очередь под названием hello и сделайте скриншот. После чего запустите второй скрипт consumer.py и сделайте скриншот результата выполнения скрипта

В качестве решения домашнего задания приложите оба скриншота, сделанных на этапе выполнения.

Для закрепления материала можете попробовать модифицировать скрипты, чтобы поменять название очереди и отправляемое сообщение.
___

**Ответ**
очередь hello 
![2](https://user-images.githubusercontent.com/94833070/195398822-3684467e-b7de-4df5-a29a-b49df4a5c1d8.png)

скриншот результата выполнения скрипта consumer.py
![3](https://user-images.githubusercontent.com/94833070/195398843-1ccb27d4-322d-42c7-9e8b-5c9e5d14dc1a.png)

# Задание 3. Подготовка HA кластера
Используя Vagrant или VirtualBox, создайте вторую виртуальную машину и установите RabbitMQ. Добавьте в файл hosts название и ip адрес каждой машины, чтобы машины могли видеть друг друга по имени.

Пример содержимого hosts файла:

$ cat /etc/hosts
192.168.0.10 rmq01
192.168.0.11 rmq02
После этого ваши машины могут пинговаться по имени.

Затем объедините две машины в кластер и создайте политику ha-all на все очереди.

В качестве решения домашнего задания приложите скриншоты из веб интерфейса с информацией о доступных нодах в кластере и включенной политикой.

Также приложите вывод команды с двух нод:

$ rabbitmqctl cluster_status
Для закрепления материала снова запустите скрипт producer.py и приложите скриншот выполнения команды на каждой из нод:

$ rabbitmqadmin get queue='hello'
После чего попробуйте отключить одну из нод, желательно, ту к которой подключались из скрипта, затем поправьте параметры подключения в скрипте consumer.py на вторую ноду и запустите его.

Приложите скриншот результата работы второго скрипта.
___
**Ответ**
Bнформация о доступных нодах в кластере и включенной политикой

![4 1](https://user-images.githubusercontent.com/94833070/195398965-ebcf90ac-0e89-493b-9699-789e637925db.png)
![5](https://user-images.githubusercontent.com/94833070/195399288-64c47176-f61a-4ab7-ba7a-4c4f5c51f93b.png)

вывод команды с двух нод: rabbitmqctl cluster_status и rabbitmqadmin get queue='hello'
![6](https://user-images.githubusercontent.com/94833070/195399341-67402162-0df3-4b07-8acb-2d034a1fa032.png)
![8](https://user-images.githubusercontent.com/94833070/195399415-10e2c98f-7401-44a7-a3d2-5b37e450d79e.png)
![8](https://user-images.githubusercontent.com/94833070/195399548-a5a3241e-d272-4500-9ed4-72c23082fd3f.png)

Запускаю  скрипт producer.py   
![7 2](https://user-images.githubusercontent.com/94833070/195399639-8ce53089-70e2-4bd5-838a-91143289587f.png)
![7](https://user-images.githubusercontent.com/94833070/195399650-6d555a01-f5a8-4b3b-9863-a2d91f822691.png)

Отключаю одну из нод и запускаю consumer.py  вывод тот же 

![9](https://user-images.githubusercontent.com/94833070/195399692-b240dd74-7b17-4ce6-89f6-03561c42ead6.png)


# Дополнительные задания (со звездочкой*)
Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

# * Задание 4. Ansible playbook
Напишите плейбук, который будет производить установку RabbitMQ на любое количество нод и объединять их в кластер. При этом будет автоматически создавать политику ha-all.

Готовый плейбук разместите в своем репозитории.
